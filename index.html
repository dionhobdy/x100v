<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fujifilm X100V Filter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: #0d0d0d;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        .camera-section {
            position: relative;
            background: #000;
            aspect-ratio: 1;
            overflow: hidden;
        }

        video, canvas {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        .controls {
            padding: 20px;
            background: #1a1a1a;
        }

        .control-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            color: #ccc;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #fff;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        input[type="range"] {
            padding: 8px;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            background: #d4af37;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            background: #d4af37;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 12px;
            background: #d4af37;
            border: none;
            border-radius: 6px;
            color: #000;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: background 0.3s;
        }

        button:hover {
            background: #e5c158;
        }

        button:active {
            transform: scale(0.98);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset-btn {
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #ccc;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #3a3a3a;
            color: #d4af37;
            border-color: #d4af37;
        }

        .preset-btn.active {
            background: #d4af37;
            color: #000;
            border-color: #d4af37;
        }

        .info-text {
            color: #888;
            font-size: 12px;
            margin-top: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="camera-section">
            <video id="video" playsinline autoplay></video>
            <canvas id="canvas" style="display:none;"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>Film Simulation</label>
                <div class="preset-buttons">
                    <button class="preset-btn active" data-preset="velvia">Velvia</button>
                    <button class="preset-btn" data-preset="astia">Astia</button>
                    <button class="preset-btn" data-preset="pro400h">Pro 400H</button>
                    <button class="preset-btn" data-preset="classic-chrome">Classic Chrome</button>
                </div>
            </div>

            <div class="control-group">
                <label>Saturation: <span id="satValue">1.2</span></label>
                <input type="range" id="saturation" min="0.5" max="2" step="0.1" value="1.2">
            </div>

            <div class="control-group">
                <label>Contrast: <span id="contValue">1.1</span></label>
                <input type="range" id="contrast" min="0.5" max="2" step="0.1" value="1.1">
            </div>

            <div class="control-group">
                <label>Warmth: <span id="warmValue">0.05</span></label>
                <input type="range" id="warmth" min="-0.2" max="0.2" step="0.05" value="0.05">
            </div>

            <div class="control-group">
                <label>Grain: <span id="grainValue">0.3</span></label>
                <input type="range" id="grain" min="0" max="1" step="0.1" value="0.3">
            </div>

            <div class="button-group">
                <button id="captureBtn">Capture Photo</button>
                <button id="downloadBtn">Download</button>
            </div>

            <div class="info-text">
                Allow camera access to get started
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let capturedImage = null;

        // Camera setup
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
            .then(stream => {
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    processFrame();
                };
            })
            .catch(err => {
                alert('Camera access denied. Please enable camera permissions.');
            });

        // Film presets (tone curves and color shifts)
        const presets = {
            velvia: { saturation: 1.4, contrast: 1.2, warmth: 0.1, colorShift: [1.1, 0.95, 0.85] },
            astia: { saturation: 1.1, contrast: 1.0, warmth: 0.05, colorShift: [1.05, 1.0, 0.95] },
            'pro400h': { saturation: 1.15, contrast: 0.9, warmth: 0.08, colorShift: [1.08, 0.98, 0.92] },
            'classic-chrome': { saturation: 1.0, contrast: 1.15, warmth: 0.03, colorShift: [1.02, 0.98, 1.0] }
        };

        let currentPreset = 'velvia';
        let settings = { ...presets.velvia, grain: 0.3 };

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPreset = btn.dataset.preset;
                const preset = presets[currentPreset];
                settings.saturation = preset.saturation;
                settings.contrast = preset.contrast;
                settings.warmth = preset.warmth;
                settings.colorShift = preset.colorShift;
                updateSliders();
            });
        });

        // Slider updates
        document.getElementById('saturation').addEventListener('input', (e) => {
            settings.saturation = parseFloat(e.target.value);
            document.getElementById('satValue').textContent = e.target.value;
        });

        document.getElementById('contrast').addEventListener('input', (e) => {
            settings.contrast = parseFloat(e.target.value);
            document.getElementById('contValue').textContent = e.target.value;
        });

        document.getElementById('warmth').addEventListener('input', (e) => {
            settings.warmth = parseFloat(e.target.value);
            document.getElementById('warmValue').textContent = e.target.value;
        });

        document.getElementById('grain').addEventListener('input', (e) => {
            settings.grain = parseFloat(e.target.value);
            document.getElementById('grainValue').textContent = e.target.value;
        });

        function updateSliders() {
            document.getElementById('saturation').value = settings.saturation;
            document.getElementById('contrast').value = settings.contrast;
            document.getElementById('warmth').value = settings.warmth;
            document.getElementById('satValue').textContent = settings.saturation.toFixed(1);
            document.getElementById('contValue').textContent = settings.contrast.toFixed(1);
            document.getElementById('warmValue').textContent = settings.warmth.toFixed(2);
        }

        // Apply Fujifilm filter
        function applyFujifilmFilter(imageData) {
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                // Color shift (emulate film stock)
                r = Math.min(255, r * (settings.colorShift?.[0] || 1));
                g = Math.min(255, g * (settings.colorShift?.[1] || 1));
                b = Math.min(255, b * (settings.colorShift?.[2] || 1));

                // Convert to HSL for saturation
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const l = (max + min) / 2 / 255;
                let s = 0;
                let h = 0;

                if (max !== min) {
                    s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (510 - max - min);
                    const delta = max - min;
                    if (max === r) h = (g - b) / delta + (g < b ? 6 : 0);
                    else if (max === g) h = (b - r) / delta + 2;
                    else h = (r - g) / delta + 4;
                    h /= 6;
                }

                // Increase saturation
                s = Math.min(1, s * settings.saturation);

                // Convert back to RGB
                const c = (1 - Math.abs(2 * l - 1)) * s;
                const x = c * (1 - Math.abs((h * 6) % 2 - 1));
                let r2 = 0, g2 = 0, b2 = 0;

                if (h < 1/6) { r2 = c; g2 = x; }
                else if (h < 2/6) { r2 = x; g2 = c; }
                else if (h < 3/6) { g2 = c; b2 = x; }
                else if (h < 4/6) { g2 = x; b2 = c; }
                else if (h < 5/6) { r2 = x; b2 = c; }
                else { r2 = c; b2 = x; }

                const m = l - c/2;
                r = Math.round((r2 + m) * 255);
                g = Math.round((g2 + m) * 255);
                b = Math.round((b2 + m) * 255);

                // Contrast
                r = Math.min(255, Math.max(0, (r - 128) * settings.contrast + 128));
                g = Math.min(255, Math.max(0, (g - 128) * settings.contrast + 128));
                b = Math.min(255, Math.max(0, (b - 128) * settings.contrast + 128));

                // Warmth (add red, reduce blue)
                r = Math.min(255, r + settings.warmth * 50);
                b = Math.max(0, b - settings.warmth * 30);

                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
            }

            // Add film grain
            if (settings.grain > 0) {
                for (let i = 0; i < data.length; i += 4) {
                    const noise = (Math.random() - 0.5) * settings.grain * 100;
                    data[i] = Math.min(255, Math.max(0, data[i] + noise));
                    data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + noise));
                    data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + noise));
                }
            }

            return imageData;
        }

        // Process video frame
        function processFrame() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const filtered = applyFujifilmFilter(imageData);
            ctx.putImageData(filtered, 0, 0);
            requestAnimationFrame(processFrame);
        }

        // Capture photo
        document.getElementById('captureBtn').addEventListener('click', () => {
            capturedImage = canvas.toDataURL('image/jpeg', 0.95);
            alert('Photo captured! Click Download to save.');
        });

        // Download photo
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (!capturedImage) {
                alert('Please capture a photo first');
                return;
            }
            const link = document.createElement('a');
            link.href = capturedImage;
            link.download = `fujifilm-x100v-${Date.now()}.jpg`;
            link.click();
        });
    </script>
</body>
</html>
